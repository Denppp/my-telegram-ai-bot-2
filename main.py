import os
import re
import requests  # ‚Üê –¥–æ–±–∞–≤–ª–µ–Ω–æ!
from flask import Flask, request, jsonify

app = Flask(__name__)

TELEGRAM_TOKEN = os.getenv("TELEGRAM_TOKEN")
if not TELEGRAM_TOKEN:
    raise ValueError("‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç TELEGRAM_TOKEN")

# === –ó–ê–ì–†–£–ñ–ê–ï–ú –°–ü–†–ê–í–û–ß–ù–ò–ö –ò–ó –§–ê–ô–õ–ê ===
# (–≤—Å—Ç–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä—è–º–æ –≤ –∫–æ–¥ ‚Äî Render –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —á—Ç–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–∏—Ö —Ñ–∞–π–ª–æ–≤ –±–µ–∑ —Å–±–æ—Ä–∫–∏)
KNOWLEDGE_BASE = {}

# –ü–∞—Ä—Å–∏–º —Ç–≤–æ–π —Ç–µ–∫—Å—Ç
raw_text = """
**–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫: –°—Ä–µ–¥—Å—Ç–≤–∞ –¥–ª—è —Ä–∞—Å—Ç–µ–Ω–∏–π**

***

**üå± –°—Ç–∏–º—É–ª—è—Ç–æ—Ä—ã —Ä–æ—Å—Ç–∞ –∏ –∫–æ—Ä–Ω–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è**

**1. –ú–∏–∫–æ—Ä–∏–∑–∞**
*   **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± —É—Å–∏–ª–µ–Ω–∏—è –∫–æ—Ä–Ω–µ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã.
*   **–î–ª—è –∫–æ–≥–æ:** –ü–ª–æ–¥–æ–≤—ã–µ –¥–µ—Ä–µ–≤—å—è, —è–≥–æ–¥–Ω–∏–∫–∏, –º–Ω–æ–≥–æ–ª–µ—Ç–Ω–∏–∫–∏.
*   **–ü–ª—é—Å—ã:** –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å—Ä–µ–¥—Å—Ç–≤–æ, –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è –∫–æ—Ä–Ω–µ–π.
*   **–ú–∏–Ω—É—Å—ã:** –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ñ—É–Ω–≥–∏—Ü–∏–¥–∞–º–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–µ–¥–∏; —Ç—Ä–µ–±—É–µ—Ç –∫–æ–Ω—Ç–∞–∫—Ç–∞ —Å –∂–∏–≤—ã–º–∏ –∫–æ—Ä–Ω—è–º–∏.

**2. –ì–µ—Ç–µ—Ä–æ–∞—É–∫—Å–∏–Ω**
*   **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –°—Ç–∏–º—É–ª–∏—Ä—É–µ—Ç –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∫–æ—Ä–Ω–µ–π —É —á–µ—Ä–µ–Ω–∫–æ–≤ –∏ –ø—Ä–∏ –ø–µ—Ä–µ—Å–∞–¥–∫–µ.
*   **–î–µ–π—Å—Ç–≤—É—é—â–µ–µ –≤–µ—â–µ—Å—Ç–≤–æ:** –ù–∞—Ç—Ä–∏–µ–≤–∞—è —Å–æ–ª—å –∏–Ω–¥–æ–ª–∏–ª–º–∞—Å–ª—è–Ω–æ–π –∫–∏—Å–ª–æ—Ç—ã.
*   **–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:** –ó–∞–º–∞—á–∏–≤–∞–Ω–∏–µ —á–µ—Ä–µ–Ω–∫–æ–≤ (1 —Ç–∞–±–ª–µ—Ç–∫–∞ –Ω–∞ 1 –ª –≤–æ–¥—ã) –∏–ª–∏ –æ–ø—É–¥—Ä–∏–≤–∞–Ω–∏–µ —Å—Ä–µ–∑–æ–≤.
*   **–ü–ª—é—Å—ã:** –í—ã—Å–æ–∫–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, –ø–æ–¥—Ö–æ–¥–∏—Ç –ø–æ—á—Ç–∏ –≤—Å–µ–º –∫—É–ª—å—Ç—É—Ä–∞–º.

**3. –ù–í-101**
*   **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –°—Ç–∏–º—É–ª–∏—Ä—É–µ—Ç —Ä–æ—Å—Ç, —É–ª—É—á—à–∞–µ—Ç –≤—Å—Ö–æ–∂–µ—Å—Ç—å —Å–µ–º—è–Ω, —É–∫—Ä–µ–ø–ª—è–µ—Ç —Ä–∞—Å—Å–∞–¥—É.
*   **–ö–∞–∫ —Ä–∞–∑–≤–æ–¥–∏—Ç—å:** 3‚Äì5 –∫–∞–ø–µ–ª—å –Ω–∞ 1 –ª–∏—Ç—Ä –≤–æ–¥—ã.
*   **–ö–∞–∫ –ø—Ä–∏–º–µ–Ω—è—Ç—å:** –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–µ–º—è–Ω –ø–µ—Ä–µ–¥ –ø–æ—Å–µ–≤–æ–º –∏–ª–∏ –æ–ø—Ä—ã—Å–∫–∏–≤–∞–Ω–∏–µ –º–æ–ª–æ–¥—ã—Ö —Ä–∞—Å—Ç–µ–Ω–∏–π.
*   **–ü–ª—é—Å—ã:** –ë–µ–∑–æ–ø–∞—Å–µ–Ω –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω, —É—Å–∫–æ—Ä—è–µ—Ç –∞–¥–∞–ø—Ç–∞—Ü–∏—é.
*   **–ú–∏–Ω—É—Å—ã:** –ù—É–∂–Ω–æ —Ç–æ—á–Ω–æ —Å–æ–±–ª—é–¥–∞—Ç—å –¥–æ–∑–∏—Ä–æ–≤–∫—É.

**4. –≠–ø–∏–Ω / –≠–ø–∏–Ω-–≠–∫—Å—Ç—Ä–∞ / –≠–ø–∏–Ω-–ê–Ω—Ç–∏—Å—Ç—Ä–µ—Å—Å**
*   **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü–æ–≤—ã—à–∞–µ—Ç —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ —Å—Ç—Ä–µ—Å—Å–∞–º (—Ö–æ–ª–æ–¥, –∑–∞—Å—É—Ö–∞, –ø–µ—Ä–µ—Å–∞–¥–∫–∞).
*   **–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:** 1 –∞–º–ø—É–ª–∞ (1 –º–ª) –Ω–∞ 5 –ª–∏—Ç—Ä–æ–≤ –≤–æ–¥—ã, –æ–ø—Ä—ã—Å–∫–∏–≤–∞–Ω–∏–µ.
*   **–ü–ª—é—Å—ã:** –£—Å–∫–æ—Ä—è–µ—Ç –ø—Ä–∏–∂–∏–≤–∞–µ–º–æ—Å—Ç—å, –ø–æ–º–æ–≥–∞–µ—Ç –ø–æ—Å–ª–µ –∑–∞–º–æ—Ä–æ–∑–∫–æ–≤.

**5. –ê–º–∏–Ω–æ–∑–æ–ª**
*   **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ê–º–∏–Ω–æ–∫–∏—Å–ª–æ—Ç–Ω—ã–π —Å—Ç–∏–º—É–ª—è—Ç–æ—Ä, –ø–∏—Ç–∞–µ—Ç —Ä–∞—Å—Ç–µ–Ω–∏—è.
*   **–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:** 1‚Äì2 –º–ª –Ω–∞ 1 –ª–∏—Ç—Ä –≤–æ–¥—ã.
*   **–ü–ª—é—Å—ã:** –£–ª—É—á—à–∞–µ—Ç –∑–∞–≤—è–∑—ã–≤–∞–µ–º–æ—Å—Ç—å –ø–ª–æ–¥–æ–≤, –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø–æ—Å–ª–µ –±–æ–ª–µ–∑–Ω–µ–π.

**6. –ì—É–º–∞—Ç –∫–∞–ª–∏—è / –ì—É–º–∞—Ç+7**
*   **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –£–ª—É—á—à–∞–µ—Ç –ø–∏—Ç–∞–Ω–∏–µ, —É–∫—Ä–µ–ø–ª—è–µ—Ç –∫–æ—Ä–Ω–∏, —Å–ø–æ—Å–æ–±—Å—Ç–≤—É–µ—Ç —Ä–æ—Å—Ç—É.
*   **–ö–∞–∫ —Ä–∞–∑–≤–æ–¥–∏—Ç—å:** 1 –º–ª –Ω–∞ 1 –ª–∏—Ç—Ä –≤–æ–¥—ã.
*   **–ö–∞–∫ –ø—Ä–∏–º–µ–Ω—è—Ç—å:** –ü–æ–ª–∏–≤ –ø–æ–¥ –∫–æ—Ä–µ–Ω—å.
*   **–ö–æ–≥–¥–∞:** 1 —Ä–∞–∑ –≤ 10‚Äì14 –¥–Ω–µ–π.
*   **–ü–ª—é—Å—ã:** –ë–µ–∑–æ–ø–∞—Å–µ–Ω, —É–ª—É—á—à–∞–µ—Ç —É—Å–≤–æ–µ–Ω–∏–µ —É–¥–æ–±—Ä–µ–Ω–∏–π.
*   **–ú–∏–Ω—É—Å—ã:** –ú–µ–¥–ª–µ–Ω–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ.

**7. –ê–∫–≤–∞—Ä–∏–Ω –¥–ª—è —Ä–∞—Å—Å–∞–¥—ã**
*   **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —É–¥–æ–±—Ä–µ–Ω–∏–µ, –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç —Ä–æ—Å—Ç, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –≤—ã—Ç—è–≥–∏–≤–∞–Ω–∏–µ.
*   **–ö–∞–∫ —Ä–∞–∑–≤–æ–¥–∏—Ç—å:** 1 —á. –ª–æ–∂–∫–∞ –Ω–∞ 1 –ª–∏—Ç—Ä –≤–æ–¥—ã.
*   **–ö–∞–∫ –ø—Ä–∏–º–µ–Ω—è—Ç—å:** –ü–æ–ª–∏–≤ –ø–æ–¥ –∫–æ—Ä–µ–Ω—å.
*   **–ü–ª—é—Å—ã:** –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –≤—Å–µ—Ö –∫—É–ª—å—Ç—É—Ä, —É–∫—Ä–µ–ø–ª—è–µ—Ç –∏–º–º—É–Ω–∏—Ç–µ—Ç.

**8. –ö—Ä–µ–ø—ã—à / –ê—Ç–ª–µ—Ç / –ö—Ä–µ–ø–µ–Ω—å**
*   **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –≤—ã—Ç—è–≥–∏–≤–∞–Ω–∏–µ —Ä–∞—Å—Å–∞–¥—ã, —É–∫—Ä–µ–ø–ª—è–µ—Ç —Å—Ç–µ–±–µ–ª—å.
*   **–ö–∞–∫ —Ä–∞–∑–≤–æ–¥–∏—Ç—å:** 1 —á. –ª–æ–∂–∫–∞ –Ω–∞ 1 –ª–∏—Ç—Ä –≤–æ–¥—ã (–¥–ª—è –ö—Ä–µ–ø–Ω—è).
*   **–ö–∞–∫ –ø—Ä–∏–º–µ–Ω—è—Ç—å:** –ü–æ–ª–∏–≤ –ø–æ–¥ –∫–æ—Ä–µ–Ω—å –∏–ª–∏ –æ–ø—Ä—ã—Å–∫–∏–≤–∞–Ω–∏–µ.
*   **–ö–æ–≥–¥–∞:** –ü–æ—Å–ª–µ –ø–æ—è–≤–ª–µ–Ω–∏—è –≤—Å—Ö–æ–¥–æ–≤, –∑–∞ 7‚Äì10 –¥–Ω–µ–π –¥–æ –≤—ã—Å–∞–¥–∫–∏.

**9. –¶–∏—Ä–∫–æ–Ω / –ù–æ–≤–æ—Å–∏–ª / –≠–Ω–µ—Ä–≥–µ–Ω**
*   **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü—Ä–µ–ø–∞—Ä–∞—Ç—ã-–∞–Ω—Ç–∏—Å—Ç—Ä–µ—Å—Å—ã, –ø–æ–≤—ã—à–∞—é—Ç —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ –Ω–µ–±–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω—ã–º —É—Å–ª–æ–≤–∏—è–º.
*   **–ö–∞–∫ —Ä–∞–∑–≤–æ–¥–∏—Ç—å:** –û–±—ã—á–Ω–æ 1 –∞–º–ø—É–ª–∞ –Ω–∞ 5 –ª–∏—Ç—Ä–æ–≤ –≤–æ–¥—ã.
*   **–ö–∞–∫ –ø—Ä–∏–º–µ–Ω—è—Ç—å:** –û–ø—Ä—ã—Å–∫–∏–≤–∞–Ω–∏–µ.
*   **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:** –ü—Ä–∏ —Å—Ç—Ä–µ—Å—Å–µ, –∑–∞–º–æ—Ä–æ–∑–∫–∞—Ö, –ø–µ—Ä–µ—Å–∞–¥–∫–µ, –¥–ª—è –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∏.

***

**üêõ –ë–æ—Ä—å–±–∞ —Å –≤—Ä–µ–¥–∏—Ç–µ–ª—è–º–∏**

**–ü—Ä–æ—Ç–∏–≤ –∫–∞–ø—É—Å—Ç–Ω–æ–π –º—É—Ö–∏:**
*   **–ó–µ–º–ª–∏–Ω:** –ì–æ—Ç–æ–≤ –∫ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é. –î–æ–ª–≥–∏–π –∑–∞—â–∏—Ç–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç. –¢–æ–∫—Å–∏—á–µ–Ω –¥–ª—è –ø—á—ë–ª.
*   **–ë–∏—Ç–æ–∫—Å–∏–±–∞—Ü–∏–ª–∏–Ω:** 50 –≥ –Ω–∞ 1 –ª –≤–æ–¥—ã, –∑–∞—Ç–µ–º –¥–æ–≤–µ—Å—Ç–∏ –¥–æ 10 –ª. –ë–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ —Å—Ä–µ–¥—Å—Ç–≤–æ, –±–µ–∑–æ–ø–∞—Å–Ω–æ.
*   **–ê–ª–∞—Ç–∞—Ä:** 1‚Äì2 –º–ª –Ω–∞ 1 –ª –≤–æ–¥—ã. –í—ã—Å–æ–∫–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, —Ç–æ–∫—Å–∏—á–Ω–æ –¥–ª—è –ø—á—ë–ª.

**–ü—Ä–æ—Ç–∏–≤ –≥—É—Å–µ–Ω–∏—Ü:**
*   **–õ–µ–ø–Ω–∏–¥–æ—Ü–∏–¥ / –ë–∏—Ç–æ–∫—Å–∏–±–∞—Ü–∏–ª–∏–Ω:** –ë–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–ø–∞—Ä–∞—Ç—ã, –±–µ–∑–æ–ø–∞—Å–Ω—ã –¥–ª—è –ª—é–¥–µ–π –∏ –∂–∏–≤–æ—Ç–Ω—ã—Ö. –î–µ–π—Å—Ç–≤–∏–µ —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π.

**–ü—Ä–æ—Ç–∏–≤ —Ç–ª–∏, –ø–∞—É—Ç–∏–Ω–Ω–æ–≥–æ –∫–ª–µ—â–∞, —Ç—Ä–∏–ø—Å–æ–≤:**
*   **–§–∏—Ç–æ–≤–µ—Ä–º:** 1‚Äì2 –º–ª –Ω–∞ 1 –ª –≤–æ–¥—ã. –ë–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ —Å—Ä–µ–¥—Å—Ç–≤–æ, –±–µ–∑–æ–ø–∞—Å–Ω–æ. –î–µ–π—Å—Ç–≤—É–µ—Ç –º–µ–¥–ª–µ–Ω–Ω–æ.
*   **–ë–∏—Ç–æ–∫—Å–∏–±–∞—Ü–∏–ª–∏–Ω:** –¢–∞–∫–∂–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω.

**–ü—Ä–æ—Ç–∏–≤ –º–µ–¥–≤–µ–¥–∫–∏, –ø—Ä–æ–≤–æ–ª–æ—á–Ω–∏–∫–∞, –º—É—Ä–∞–≤—å—ë–≤:**
*   **–ú–µ–¥–≤–µ–¥–æ–∫—Å / –ü—Ä–æ–≤–æ—Ç–æ–∫—Å / –†–æ—Ñ–∞—Ç–æ–∫—Å –ó–ê–†–ò–¢:** –•–∏–º–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–ø–∞—Ä–∞—Ç—ã. –û—á–µ–Ω—å —Ç–æ–∫—Å–∏—á–Ω—ã, —Ç—Ä–µ–±—É—é—Ç –∑–∞—â–∏—Ç—ã. –î–µ–π—Å—Ç–≤—É—é—Ç –¥–æ–ª–≥–æ.

***

**‚ö†Ô∏è –ë–æ—Ä—å–±–∞ —Å –±–æ–ª–µ–∑–Ω—è–º–∏**

*   **–¢–æ–ø–∞–∑:** –ü—Ä–æ—Ç–∏–≤ –º—É—á–Ω–∏—Å—Ç–æ–π —Ä–æ—Å—ã, —Ä–∂–∞–≤—á–∏–Ω—ã. –°–∏—Å—Ç–µ–º–Ω—ã–π —Ñ—É–Ω–≥–∏—Ü–∏–¥.
*   **–§–∏—Ç–æ—Å–ø–æ—Ä–∏–Ω, –ì–∞–º–∞–∏—Ä:** –ë–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–≥–∏—Ü–∏–¥—ã. –ë–µ–∑–æ–ø–∞—Å–Ω—ã, –ø–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∏.
*   **–ö–æ–º–±–∏–Ω–∞—Ü–∏–∏:** –•–æ—Ä—Ç–æ–Ω (–•–æ—Ä—É—Å) + –ê–ª–∞—Ç–∞—Ä, –ö–æ—Ä—Ç–ª–∏—Å + –°–∫–æ—Ä, –ë–∏–æ–∫–∏–ª + –¢—Ä–∏—Ö–æ–¥–µ—Ä–º–∞.

***

**üåø –£–¥–æ–±—Ä–µ–Ω–∏—è**

**–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ:**
*   **–§–µ—Ä—Ç–∏–∫–∞ –õ—é–∫—Å:** –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–æ—Å—Ç–∞–≤ (NPK + –º–∏–∫—Ä–æ—ç–ª–µ–º–µ–Ω—Ç—ã). 20 –≥ –Ω–∞ 10 –ª –≤–æ–¥—ã.
*   **–ê–∫–≤–∞—Ä–∏–Ω —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π:** 1 —Å—Ç. –ª–æ–∂–∫–∞ –Ω–∞ 10 –ª –≤–æ–¥—ã.
*   **–ì—É–º–∞—Ç—ã:** –£–ª—É—á—à–∞—é—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–æ—á–≤—ã –∏ —É—Å–≤–æ–µ–Ω–∏–µ. 1 –º–ª –Ω–∞ 1 –ª –≤–æ–¥—ã.

**–î–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∫—É–ª—å—Ç—É—Ä:**
*   **–ê–∫–≤–∞—Ä–∏–Ω –¥–ª—è –ø–µ—Ç—É–Ω–∏–π / —Ä–æ–¥–æ–¥–µ–Ω–¥—Ä–æ–Ω–æ–≤:** –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ñ–æ—Ä–º—É–ª—ã –¥–ª—è —Ü–≤–µ—Ç–µ–Ω–∏—è.
*   **–î–ª—è –ª—É–∫–∞, —á–µ—Å–Ω–æ–∫–∞, —Ç–æ–º–∞—Ç–æ–≤, –æ–≥—É—Ä—Ü–æ–≤, –∫–∞–ø—É—Å—Ç—ã:** –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø–æ–¥–∫–æ—Ä–º–∫–∏ (–æ–±—ã—á–Ω–æ 1 –≥ –Ω–∞ 1 –ª –≤–æ–¥—ã –¥–ª—è –æ–ø—Ä—ã—Å–∫–∏–≤–∞–Ω–∏—è).

***

**üìù –û–±—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
*   –í—Å–µ–≥–¥–∞ —á–∏—Ç–∞–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é.
*   –ü–æ–¥–∫–∞—Ä–º–ª–∏–≤–∞–π—Ç–µ –ø–æ—Å–ª–µ –ø–æ–ª–∏–≤–∞.
*   –û–ø—Ä—ã—Å–∫–∏–≤–∞–Ω–∏–µ –ª—É—á—à–µ –ø—Ä–æ–≤–æ–¥–∏—Ç—å –≤–µ—á–µ—Ä–æ–º –∏–ª–∏ –≤ –ø–∞—Å–º—É—Ä–Ω—É—é –ø–æ–≥–æ–¥—É.
*   **–ù–ï–õ–¨–ó–Ø** –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ö–∏–º–∏–µ–π –≤–æ –≤—Ä–µ–º—è —Ü–≤–µ—Ç–µ–Ω–∏—è –∏ –∑–∞ 20 –¥–Ω–µ–π –¥–æ —Å–±–æ—Ä–∞ —É—Ä–æ–∂–∞—è.
"""

# –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ –±–ª–æ–∫–∏ –ø–æ –ø—Ä–µ–ø–∞—Ä–∞—Ç–∞–º (–Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å "1.", "2.", "‚úîÔ∏è", "üß™" –∏ —Ç.–¥.)
blocks = re.split(r'\n(?=\d+\.\s|\w+:\s*‚úîÔ∏è|\w+:\s*üåø|\w+:\s*‚ö†Ô∏è|\w+:\s*üå±|\w+:\s*üíß)', raw_text)

for block in blocks:
    block = block.strip()
    if not block or len(block) < 20:
        continue

    # –ò–∑–≤–ª–µ–∫–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ (–¥–æ –ø–µ—Ä–≤–æ–π —Ç–æ—á–∫–∏ –∏–ª–∏ –¥–≤–æ–µ—Ç–æ—á–∏—è)
    name_match = re.search(r'^(?:\d+\.\s*)?([–ê-–Ø–∞-—è–Å—ë\w\s\-]+?)(?:[:.]|$)', block)
    if not name_match:
        continue

    name = name_match.group(1).strip().lower()
    if "—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫" in name or "–∫–∞–Ω–∞–ª" in name or "—Å–æ–∑–¥–∞–Ω" in name:
        continue

    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª–Ω—ã–π –±–ª–æ–∫ –∫–∞–∫ –µ—Å—Ç—å
    KNOWLEDGE_BASE[name] = block

# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –¥–æ–±–∞–≤–∏–º –∞–ª–∏–∞—Å—ã (—Å–∏–Ω–æ–Ω–∏–º—ã)
ALIASES = {
    "–º—É—Ä–∞–≤—å–µ–¥": "–º—É—Ä–∞–≤—å–µ–¥",
    "–≤–µ–ª–∏–∫–∏–π –≤–æ–∏–Ω": "–≤–µ–ª–∏–∫–∏–π –≤–æ–∏–Ω",
    "–∞–∫—Ç–∞—Ä–∞": "–∞–∫—Ç–∞—Ä–∞",
    "–∞–ª–∞—Ç–∞—Ä": "–∞–ª–∞—Ç–∞—Ä",
    "—Ñ—É—Ñ–∞–Ω–æ–Ω": "—Ñ—É—Ñ–∞–Ω–æ–Ω",
    "–∏—Å–∫—Ä–∞": "–∏—Å–∫—Ä–∞",
    "—Ñ–∏—Ç–æ–≤–µ—Ä–º": "—Ñ–∏—Ç–æ–≤–µ—Ä–º",
    "–±–∏—Ç–æ–∫—Å–∏–±–∞—Ü–∏–ª–∏–Ω": "–±–∏—Ç–æ–∫—Å–∏–±–∞—Ü–∏–ª–∏–Ω",
    "—Ö–æ—Ä—É—Å": "—Ö–æ—Ä—É—Å",
    "—Å–∫–æ—Ä": "—Å–∫–æ—Ä",
    "—Ç–∞–±—É": "—Ç–∞–±—É",
    "–ø—Ä–µ—Å—Ç–∏–∂": "–ø—Ä–µ—Å—Ç–∏–∂",
    "–∑–µ–º–ª–∏–Ω": "–∑–µ–º–ª–∏–Ω",
    "–≥—Ä–æ–º": "–≥—Ä–æ–º 2",
    "–ø—Ä–æ–≤–æ—Ç–æ–∫—Å": "–ø—Ä–æ–≤–æ—Ç–æ–∫—Å",
    "—Ä–æ—Ñ–∞—Ç–æ–∫—Å": "—Ä–æ—Ñ–∞—Ç–æ–∫—Å –∑–∞—Ä–∏—Ç",
    "–º–µ—Ç–∞—Ä–∏–∑–∏–Ω": "–º–µ—Ç–∞—Ä–∏–∑–∏–Ω",
    "—Ñ–µ—Ä—Ç–∏–∫–∞": "—Ñ–µ—Ä—Ç–∏–∫–∞ –ª—é–∫—Å",
    "–º–∞–≥-–±–æ—Ä": "–º–∞–≥-–±–æ—Ä",
    "—Å—É–¥–∞—Ä—É—à–∫–∞": "—Å—É–¥–∞—Ä—É—à–∫–∞",
    "–≥—É–º–∞—Ç": "–≥—É–º–∞—Ç –ø–ª–æ–¥–æ—Ä–æ–¥–∏–µ",
    "–Ω–∞—à–∞—Ç—ã—Ä–Ω—ã–π —Å–ø–∏—Ä—Ç": "–Ω–∞—à–∞—Ç—ã—Ä–Ω—ã–π —Å–ø–∏—Ä—Ç",
    "–∫–æ—Ä–Ω–µ–≤–∏–Ω": "–∫–æ—Ä–Ω–µ–≤–∏–Ω",
    "–º–∏–∫–æ—Ä–∏–∑–∞": "–º–∏–∫–æ—Ä–∏–∑–∞",
    "–≥–µ—Ç–µ—Ä–æ–∞—É–∫—Å–∏–Ω": "–≥–µ—Ç–µ—Ä–æ–∞—É–∫—Å–∏–Ω"
}

def search_knowledge(query):
    query = query.strip().lower()
    
    # –ü—Ä—è–º–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
    for key in KNOWLEDGE_BASE:
        if query == key or query in key or key in query:
            return KNOWLEDGE_BASE[key]
    
    # –ü–æ –∞–ª–∏–∞—Å–∞–º
    for alias, full_name in ALIASES.items():
        if alias in query:
            if full_name in KNOWLEDGE_BASE:
                return KNOWLEDGE_BASE[full_name]
    
    # –ß–∞—Å—Ç–∏—á–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ —Å–ª–æ–≤–∞–º
    words = query.split()
    for key, content in KNOWLEDGE_BASE.items():
        if any(word in key for word in words):
            return content
    
    return "–ù–µ –Ω–∞–π–¥–µ–Ω–æ. –ù–∞–ø–∏—à–∏—Ç–µ —Ç–æ—á–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ –∏–ª–∏ –∫—É–ª—å—Ç—É—Ä—ã."

# === Health check ===
@app.route("/", methods=["GET", "HEAD"])
def health_check():
    return "OK", 200

# === Webhook ===
@app.route("/", methods=["POST"])
def webhook():
    try:
        update = request.get_json()
        if not update or "message" not in update:
            return jsonify({"ok": True})

        msg = update["message"]
        chat_id = msg["chat"]["id"]
        text = msg.get("text", "").strip()

        if text == "/start":
            reply = (
                "–ü—Ä–∏–≤–µ—Ç! –Ø ‚Äî –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –ø–æ —Å—Ä–µ–¥—Å—Ç–≤–∞–º –∑–∞—â–∏—Ç—ã —Ä–∞—Å—Ç–µ–Ω–∏–π –∏ —É–¥–æ–±—Ä–µ–Ω–∏—è–º.\n\n"
                "–ù–∞–ø–∏—à–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–ø–∞—Ä–∞—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: *–ú—É—Ä–∞—Ü–∏–¥*, *–ê–∫—Ç–∞—Ä–∞*, *–§–∏—Ç–æ–≤–µ—Ä–º*) –∏–ª–∏ –∫—É–ª—å—Ç—É—Ä—É (*–∫–∞—Ä—Ç–æ—Ñ–µ–ª—å*, *–∫–∞–ø—É—Å—Ç–∞*), "
                "–∏ —è –¥–∞–º —Ç–æ—á–Ω—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é: –æ—Ç —á–µ–≥–æ –ø–æ–º–æ–≥–∞–µ—Ç, –∫–∞–∫ —Ä–∞–∑–≤–æ–¥–∏—Ç—å, –ø–ª—é—Å—ã –∏ –º–∏–Ω—É—Å—ã."
            )
        else:
            reply = search_knowledge(text)

        # –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–≤–µ—Ç–∞
        requests.post(
            f"https://api.telegram.org/bot{TELEGRAM_TOKEN}/sendMessage",
            json={"chat_id": chat_id, "text": reply, "parse_mode": "Markdown"},
            timeout=10
        )
        return jsonify({"ok": True})

    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
        return jsonify({"ok": True})

if __name__ == "__main__":
    port = int(os.environ.get("PORT", 8080))
    app.run(host="0.0.0.0", port=port)
